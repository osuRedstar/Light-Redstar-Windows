# LETS Test Server
upstream lets-TS {
    server 124.58.110.100:5002 fail_timeout=0;
}
# Bancho Server Test Server
upstream bancho-TS {
    server 124.58.110.100:5001 fail_timeout=0;
}

server {
    listen 80;
    server_name xi-overthe.top;
    return 308 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name xi-overthe.top;

    location / {
        root   html;
        index  index.html;
    }
}

# Hanayo frontend
server {
    listen 80;
    #server_name osu.ppy.sh www.osu.ppy.sh;
    server_name osu.xi-overthe.top;
    return 308 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    #server_name osu.ppy.sh www.osu.ppy.sh;
    server_name osu.xi-overthe.top;

    #ssl on;
    ssl_certificate './osu/cert/cert.crt';
    ssl_certificate_key './osu/cert/cert.key';
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;

    location /d/  {
        return 301 https://b.xi-overthe.top$request_uri;
        #proxy_set_header X-Real-IP $real_IP;
        #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #proxy_set_header X-Forwarded-Proto https;
        #proxy_set_header Host $http_host;
        #proxy_redirect off;
        #proxy_pass http://124.58.110.110:6200$request_uri;
    }

    location / {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://124.58.110.100:6060;
    }

    #rippleapi
    location /api {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded_for $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_redirect off;
        proxy_pass http://124.58.110.100:40001;
    }

    #lets
    location ~ ^/(web|ss)/ {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://lets-TS;
    }

    location /users {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://lets-TS;
    }

}

# Avatar server
server {
    listen 80;
    #server_name a.ppy.sh;
    server_name a.xi-overthe.top;
    return 308 https://$server_name$request_uri;
}

server {
    listen 443 ssl; 
    #server_name a.ppy.sh;
    server_name a.xi-overthe.top;

    ssl_certificate './osu/cert/cert.crt';
    ssl_certificate_key './osu/cert/cert.key';
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;

    location / {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://124.58.110.100:5000;    # default port is 5000
    }
}

#b
server {
    listen 80;
    server_name b.xi-overthe.top;
    return 301 https://$server_name$request_uri;
}

#b ssl
server {
    listen 443 ssl; 
    server_name b.xi-overthe.top;

    ssl_certificate './osu/cert/cert.crt';
    ssl_certificate_key './osu/cert/cert.key';
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;

    location / {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://124.58.110.110:6200;
    }
}

# Bancho server
server {
    listen 443 ssl;
    listen 80;
    #server_name c.ppy.sh c1.ppy.sh c2.ppy.sh c3.ppy.sh c4.ppy.sh c5.ppy.sh c6.ppy.sh c7.ppy.sh c8.ppy.sh c9.ppy.sh ce.ppy.sh;
    server_name c.xi-overthe.top;

    ssl_certificate './osu/cert/cert.crt';
    ssl_certificate_key './osu/cert/cert.key';
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;

    location / {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://bancho-TS;
    }
}

# Old frontend
server {
    listen 80;
    #server_name old.i-need-to.click;
    server_name old.xi-overthe.top;
    return 308 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    #server_name old.i-need-to.click;
    server_name old.xi-overthe.top;

    root /var/www/osu.ppy.sh;
    index index.php index.html;

    #Certificate pathes
    ssl_certificate './osu/cert/cert.crt';
    ssl_certificate_key './osu/cert/cert.key';
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;

    ssl_protocols TLSv1.2;

    #Headers
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload;" always;
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Robots-Tag none;

    location ~ ^/(web|ss|s|d|b|letsapi)/ {
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://lets-TS;
    }

    location / {
        #autoindex on;
        index index.php;
        rewrite ^/(u|d)/[0-9]+$ /rewrite.php;
    }
}

#Admin.xi-overthe.top (Web)
server {
    listen 80;
    #server_name osu.ppy.sh www.osu.ppy.sh;
    server_name admin.xi-overthe.top;
    return 308 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name admin.xi-overthe.top;

    #ssl on;
    ssl_certificate './osu/cert/cert.crt';
    ssl_certificate_key './osu/cert/cert.key';
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;

    location / {
        add_header 'Access-Control-Allow-Origin' '*';
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://124.58.110.100:1337;
    }
}

#cheesegull
server {
    listen 80;
    server_name cheesegull.xi-overthe.top;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name cheesegull.xi-overthe.top;

    #ssl on;
    ssl_certificate './osu/cert/cert.crt';
    ssl_certificate_key './osu/cert/cert.key';
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;

    location / {
        add_header 'Access-Control-Allow-Origin' '*';
        proxy_set_header X-Real-IP $real_IP;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://124.58.110.110:6201;
    }
}